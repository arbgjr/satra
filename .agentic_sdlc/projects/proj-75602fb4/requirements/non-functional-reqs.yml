non_functional_requirements:
  metadata:
    project_id: proj-75602fb4
    project_name: "Sistema de Alertas B3"
    created_at: '2026-01-17T04:03:05Z'
    updated_at: '2026-01-17T04:03:05Z'
    created_by: requirements-analyst
    phase: 1
    version: "1.0.0"

  summary: |
    Requisitos nao-funcionais (NFRs) do Sistema de Alertas B3, definindo
    qualidade, performance, seguranca e compliance que o sistema deve atender.

  # ==========================================================================
  # PERFORMANCE
  # ==========================================================================
  performance:
    - id: NFR-PERF-001
      category: latency
      title: "Latencia de Alertas"
      description: |
        Alertas devem ser disparados em tempo habil para permitir acao do usuario.

      requirement: |
        Tempo entre evento de mercado e notificacao ao usuario < 30 segundos

      acceptance_criteria:
        - "p50 latencia < 15 segundos"
        - "p95 latencia < 25 segundos"
        - "p99 latencia < 30 segundos"
        - "Zero alertas com latencia > 60 segundos"

      measurement:
        metric: "alert_latency_seconds"
        tool: "Prometheus + Grafana"
        sampling: "all alerts"

      priority: critical
      rationale: |
        Mercado financeiro exige rapidez. Alertas atrasados perdem utilidade.
        30 segundos e threshold aceitavel considerando rate limits da API gratuita.

    - id: NFR-PERF-002
      category: throughput
      title: "Throughput de Ingestao de Dados"
      description: |
        Sistema deve suportar ingestao de dados de multiplos ativos simultaneamente.

      requirement: |
        Ingerir dados de 100 ativos em < 5 minutos (respeitando rate limits)

      acceptance_criteria:
        - "100 ativos processados por ciclo de 5 minutos"
        - "Rate limit de 5 calls/min respeitado"
        - "Cache hit ratio > 80% apos warm-up"

      measurement:
        metric: "ingestion_assets_per_cycle"
        tool: "Application metrics"
        sampling: "each ingestion cycle"

      priority: high
      rationale: |
        Free tier Alpha Vantage limita a 5 calls/min.
        100 ativos em 5 min = 20 ativos/min = 4 ativos/call batch.

    - id: NFR-PERF-003
      category: response_time
      title: "Response Time da API"
      description: |
        APIs REST devem responder rapidamente para boa experiencia de usuario.

      requirement: |
        Response time < 200ms para endpoints single-resource

      acceptance_criteria:
        - "p50 response time < 100ms"
        - "p95 response time < 200ms"
        - "p99 response time < 500ms"
        - "Batch endpoints (10 assets): p95 < 500ms"

      measurement:
        metric: "api_response_time_ms"
        tool: "APM (Application Performance Monitoring)"
        sampling: "all requests"

      priority: high
      rationale: |
        Dashboard precisa de respostas rapidas para UX fluida.
        Cache Redis garante response times baixos para dados frequentes.

    - id: NFR-PERF-004
      category: frontend
      title: "Core Web Vitals"
      description: |
        Dashboard web deve atender metricas de performance do Google.

      requirement: |
        LCP < 2.5s, FID < 100ms, CLS < 0.1

      acceptance_criteria:
        - "Largest Contentful Paint (LCP) < 2.5 segundos"
        - "First Input Delay (FID) < 100 milissegundos"
        - "Cumulative Layout Shift (CLS) < 0.1"
        - "Time to Interactive (TTI) < 3.8 segundos"

      measurement:
        metric: "core_web_vitals"
        tool: "Lighthouse / PageSpeed Insights"
        sampling: "weekly automated tests"

      priority: medium
      rationale: |
        Afeta SEO e experiencia do usuario.
        PWA deve carregar rapido mesmo em conexoes moveis.

  # ==========================================================================
  # SCALABILITY
  # ==========================================================================
  scalability:
    - id: NFR-SCALE-001
      category: users
      title: "Escalabilidade de Usuarios"
      description: |
        Sistema deve escalar para suportar crescimento de base de usuarios.

      requirement: |
        MVP: 100 usuarios concorrentes. Futuro: 10.000 usuarios concorrentes.

      acceptance_criteria:
        - "MVP: 100 usuarios com < 5% degradacao de performance"
        - "Arquitetura stateless para horizontal scaling"
        - "Database connection pooling configurado"
        - "Load test validado para 100 usuarios"

      scaling_plan:
        mvp: "Single instance, vertical scaling se necessario"
        growth: "Kubernetes com HPA (Horizontal Pod Autoscaler)"
        enterprise: "Multi-region com CDN"

      priority: high
      rationale: |
        MVP foca em validar produto.
        Arquitetura deve permitir escala sem rewrite significativo.

    - id: NFR-SCALE-002
      category: alerts
      title: "Escalabilidade de Alertas"
      description: |
        Engine de alertas deve escalar para alto volume de regras.

      requirement: |
        Suportar 10.000 alertas ativos simultaneamente

      acceptance_criteria:
        - "10.000 regras avaliadas em < 10 segundos por ciclo"
        - "Memory footprint < 1GB para 10.000 regras"
        - "CPU utilization < 50% em steady state"

      scaling_plan:
        mvp: "Single worker process"
        growth: "Worker pool com particionamento por ativo"
        enterprise: "Streaming engine (Flink/Spark Streaming)"

      priority: medium
      rationale: |
        100 usuarios * 5 alertas/usuario = 500 alertas no MVP.
        10.000 alertas prepara para 2.000 usuarios premium.

  # ==========================================================================
  # AVAILABILITY
  # ==========================================================================
  availability:
    - id: NFR-AVAIL-001
      category: uptime
      title: "Disponibilidade durante Pregao"
      description: |
        Sistema deve estar disponivel durante horario de negociacao da B3.

      requirement: |
        99% de disponibilidade durante horario de pregao (10h-17h BRT)

      acceptance_criteria:
        - "Uptime >= 99% durante pregao"
        - "Downtime maximo planejado: 15 min/semana (fora do pregao)"
        - "Downtime nao planejado: < 7 horas/ano durante pregao"
        - "Health check endpoint com latencia < 100ms"

      measurement:
        metric: "uptime_percentage"
        tool: "UptimeRobot / Pingdom"
        sampling: "every 1 minute"

      priority: critical
      rationale: |
        Alertas so fazem sentido durante horario de mercado.
        99% = ~7 horas de downtime/ano durante pregao.

    - id: NFR-AVAIL-002
      category: resilience
      title: "Tolerancia a Falhas de Dependencias"
      description: |
        Sistema deve continuar operando quando dependencias estao indisponiveis.

      requirement: |
        Graceful degradation quando Alpha Vantage ou Redis estao down

      acceptance_criteria:
        - "Fallback para dados em cache quando API indisponivel"
        - "Alertas continuam usando ultimos dados conhecidos"
        - "Notificacao ao usuario sobre dados potencialmente stale"
        - "Circuit breaker ativado apos 3 falhas consecutivas"

      resilience_patterns:
        - pattern: "Circuit Breaker"
          applies_to: "Alpha Vantage API calls"
        - pattern: "Fallback"
          applies_to: "Cache miss -> dados historicos"
        - pattern: "Bulkhead"
          applies_to: "Isolamento de workers"

      priority: high
      rationale: |
        APIs gratuitas podem ter instabilidade.
        Sistema nao deve falhar completamente por dependencia externa.

  # ==========================================================================
  # SECURITY
  # ==========================================================================
  security:
    - id: NFR-SEC-001
      category: authentication
      title: "Autenticacao Segura"
      description: |
        Sistema deve implementar autenticacao robusta.

      requirement: |
        JWT com refresh tokens, MFA opcional para premium

      acceptance_criteria:
        - "Access token expira em 15 minutos"
        - "Refresh token expira em 7 dias"
        - "Tokens assinados com RS256 (asymmetric)"
        - "Brute force protection: 5 tentativas em 15 min"
        - "Session invalidation ao trocar senha"

      implementation:
        - "Keycloak ou Identity Server"
        - "OAuth 2.0 / OpenID Connect"
        - "PKCE para flows SPA"

      priority: critical
      rationale: |
        Dados de alertas podem revelar estrategias de investimento.
        Contas comprometidas podem causar danos financeiros.

    - id: NFR-SEC-002
      category: data_protection
      title: "Protecao de Dados em Transito"
      description: |
        Toda comunicacao deve ser criptografada.

      requirement: |
        TLS 1.2+ obrigatorio para todas as conexoes

      acceptance_criteria:
        - "HTTPS only (HSTS enabled)"
        - "TLS 1.2 minimo, TLS 1.3 preferido"
        - "Certificado SSL A+ no SSL Labs"
        - "No mixed content (HTTP/HTTPS)"

      implementation:
        - "Let's Encrypt ou similar"
        - "Cloudflare/CDN para SSL termination"
        - "Strict-Transport-Security header"

      priority: critical
      rationale: |
        Dados pessoais e financeiros devem ser protegidos em transito.
        Requisito basico de seguranca.

    - id: NFR-SEC-003
      category: data_protection
      title: "Protecao de Dados em Repouso"
      description: |
        Dados sensiveis devem ser criptografados no banco de dados.

      requirement: |
        Encryption at rest para dados pessoais e credenciais

      acceptance_criteria:
        - "Database encryption (TDE ou similar)"
        - "Passwords com bcrypt (cost factor 12)"
        - "API keys criptografadas com AES-256"
        - "Secrets em vault (Azure Key Vault, HashiCorp Vault)"

      implementation:
        - "PostgreSQL with TDE"
        - "Environment secrets via Azure Key Vault"
        - "No secrets in code or config files"

      priority: critical
      rationale: |
        LGPD exige protecao de dados pessoais.
        Compliance com boas praticas de seguranca.

    - id: NFR-SEC-004
      category: api_security
      title: "Seguranca de API"
      description: |
        APIs devem ser protegidas contra ataques comuns.

      requirement: |
        Rate limiting, input validation, CORS restritivo

      acceptance_criteria:
        - "Rate limit: 60 req/min (free), 600 req/min (premium)"
        - "Input validation em todos os endpoints"
        - "SQL injection prevention (parameterized queries)"
        - "XSS prevention (output encoding)"
        - "CORS apenas para dominios autorizados"

      implementation:
        - "ASP.NET Core rate limiting middleware"
        - "FluentValidation para input"
        - "Entity Framework para queries"

      priority: high
      rationale: |
        API publica exposta na internet.
        Ataques automatizados sao comuns.

  # ==========================================================================
  # COMPLIANCE
  # ==========================================================================
  compliance:
    - id: NFR-COMP-001
      category: lgpd
      title: "Conformidade LGPD"
      description: |
        Sistema deve estar em conformidade com Lei Geral de Protecao de Dados.

      requirement: |
        Implementar direitos dos titulares e base legal para tratamento

      acceptance_criteria:
        - "Consentimento explicito no registro"
        - "Direito de acesso: exportar dados do usuario"
        - "Direito de exclusao: deletar conta e dados"
        - "Direito de portabilidade: export em formato estruturado"
        - "Politica de privacidade clara e acessivel"
        - "DPO designado (ou responsavel)"

      implementation:
        - "Consent checkbox no registro"
        - "Pagina /privacy com politica"
        - "Endpoint DELETE /api/v1/users/me"
        - "Endpoint GET /api/v1/users/me/export"

      priority: critical
      rationale: |
        LGPD e lei federal brasileira.
        Multas podem chegar a 2% do faturamento.

    - id: NFR-COMP-002
      category: cvm
      title: "Conformidade CVM"
      description: |
        Sistema nao pode ser caracterizado como assessoria de investimentos.

      requirement: |
        Disclaimers claros em todas as interfaces e comunicacoes

      acceptance_criteria:
        - "Disclaimer no footer: 'Este servico nao constitui assessoria de investimentos'"
        - "Disclaimer em cada alerta enviado"
        - "Termo de uso explicito sobre natureza informativa"
        - "Nenhuma recomendacao de compra/venda"

      implementation:
        - "Footer component com disclaimer"
        - "Template de email com disclaimer"
        - "Termos de uso revisados por advogado"

      priority: critical
      rationale: |
        Assessoria de investimentos requer registro na CVM.
        Sistema e puramente informativo.

    - id: NFR-COMP-003
      category: b3_terms
      title: "Termos de Uso de Dados B3"
      description: |
        Uso de dados de mercado deve respeitar termos da B3 e provedores.

      requirement: |
        Verificar e cumprir termos de licenciamento de dados

      acceptance_criteria:
        - "Termos Alpha Vantage revisados e aceitos"
        - "Atribuicao de fonte quando requerido"
        - "Dados nao redistribuidos em raw format"
        - "Uso comercial permitido pelo tier da API"

      implementation:
        - "Revisao de ToS Alpha Vantage"
        - "Link 'Dados fornecidos por Alpha Vantage' no footer"
        - "Apenas metricas calculadas expostas, nao dados raw"

      priority: high
      rationale: |
        Dados de mercado tem licenciamento especifico.
        Violacao pode resultar em bloqueio de API.

  # ==========================================================================
  # USABILITY
  # ==========================================================================
  usability:
    - id: NFR-UX-001
      category: accessibility
      title: "Acessibilidade WCAG"
      description: |
        Dashboard deve ser acessivel para usuarios com deficiencias.

      requirement: |
        Conformidade WCAG 2.1 nivel AA

      acceptance_criteria:
        - "Contraste de cores >= 4.5:1"
        - "Navegacao por teclado completa"
        - "Labels em formularios"
        - "Alt text em imagens"
        - "Suporte a screen readers"

      measurement:
        tool: "axe DevTools / WAVE"
        sampling: "cada release"

      priority: medium
      rationale: |
        Inclusao e boa pratica.
        Pode ser requisito legal no futuro.

    - id: NFR-UX-002
      category: mobile
      title: "Mobile-First Design"
      description: |
        Interface deve funcionar perfeitamente em dispositivos moveis.

      requirement: |
        PWA instalavel com experiencia nativa

      acceptance_criteria:
        - "Responsivo: breakpoints para mobile, tablet, desktop"
        - "Touch-friendly: botoes >= 44x44px"
        - "Instalavel como app (manifest.json)"
        - "Offline: exibe ultimos dados quando sem conexao"

      implementation:
        - "Next.js com PWA plugin"
        - "Service Worker para cache"
        - "Mobile-first CSS"

      priority: high
      rationale: |
        Traders consultam mercado no celular.
        PWA reduz barreira de instalacao.

  # ==========================================================================
  # MAINTAINABILITY
  # ==========================================================================
  maintainability:
    - id: NFR-MAINT-001
      category: observability
      title: "Observabilidade Completa"
      description: |
        Sistema deve ter logs, metricas e traces para troubleshooting.

      requirement: |
        Structured logging, metricas Prometheus, traces distribuidos

      acceptance_criteria:
        - "Logs em JSON com correlation ID"
        - "Metricas expostas em /metrics (Prometheus format)"
        - "Traces distribuidos (OpenTelemetry)"
        - "Dashboards pre-configurados no Grafana"
        - "Alertas de SRE para anomalias"

      implementation:
        - "Serilog para logs"
        - "Prometheus.NET para metricas"
        - "Loki para log aggregation"
        - "Grafana dashboards"

      priority: high
      rationale: |
        Sem observabilidade, debugging e impossivel.
        Essencial para operacao de producao.

    - id: NFR-MAINT-002
      category: testability
      title: "Cobertura de Testes"
      description: |
        Codigo deve ter testes automatizados suficientes.

      requirement: |
        80% de cobertura de codigo, testes de integracao para APIs

      acceptance_criteria:
        - "Unit tests: >= 80% coverage"
        - "Integration tests para todos os endpoints"
        - "E2E tests para fluxos criticos (registro, alerta)"
        - "Performance tests para NFRs de latencia"

      implementation:
        - "xUnit para .NET / Jest para React"
        - "TestContainers para integracao"
        - "Playwright para E2E"
        - "k6 para performance"

      priority: high
      rationale: |
        Testes previnem regressoes.
        Essencial para CI/CD confiavel.

    - id: NFR-MAINT-003
      category: documentation
      title: "Documentacao Tecnica"
      description: |
        Sistema deve ter documentacao para desenvolvedores e operadores.

      requirement: |
        OpenAPI spec, ADRs, runbooks

      acceptance_criteria:
        - "OpenAPI 3.0 spec para todas as APIs"
        - "README com setup local"
        - "ADRs para decisoes arquiteturais"
        - "Runbooks para operacoes comuns"
        - "Documentacao atualizada em cada release"

      implementation:
        - "Swagger UI para API docs"
        - "ADRs em .agentic_sdlc/decisions/"
        - "Runbooks em docs/operations/"

      priority: medium
      rationale: |
        Documentacao reduz onboarding time.
        Runbooks essenciais para incidentes.

  # ==========================================================================
  # SUMMARY
  # ==========================================================================
  summary:
    total_nfrs: 17
    by_category:
      performance: 4
      scalability: 2
      availability: 2
      security: 4
      compliance: 3
      usability: 2
      maintainability: 3

    critical_nfrs:
      - NFR-PERF-001  # Latencia de Alertas
      - NFR-AVAIL-001 # Disponibilidade durante Pregao
      - NFR-SEC-001   # Autenticacao Segura
      - NFR-SEC-002   # Protecao de Dados em Transito
      - NFR-SEC-003   # Protecao de Dados em Repouso
      - NFR-COMP-001  # Conformidade LGPD
      - NFR-COMP-002  # Conformidade CVM

    mvp_focus: |
      Para o MVP, focar em NFRs criticos:
      - Performance: latencia de alertas
      - Seguranca: autenticacao e protecao de dados
      - Compliance: LGPD e CVM

      NFRs de escalabilidade podem ser relaxados no MVP
      desde que arquitetura permita evolucao.
